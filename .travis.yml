language: go

go:
  - 1.10.x
  - 1.11.x

go_import_path: github.com/guitarpawat/wsp-ecommerce

env:
  global:
    - JYTHON=false
addons:
  apt:
    sources:
      - google-chrome
    packages:
      - google-chrome-stable

branches:
  only:
  - /.*/

before_install:
  - go get -t -v ./...

jobs:
  include:
    - stage: Backend Test
      script: go test -race -coverprofile=coverage.txt -covermode=atomic ./...
    - stage: Frontend Test
      script: CDVERSION=`curl http://chromedriver.storage.googleapis.com/LATEST_RELEASE`
      script: wget --no-verbose http://chromedriver.storage.googleapis.com/$CDVERSION/chromedriver_linux64.zip
      script: unzip chromedriver_linux64.zip
      script: sudo chmod u+x chromedriver
      script: sudo mv chromedriver /usr/bin/
      script: sudo apt-get install python3
      script: sudo apt-get install python3-pip
      script: sudo pip3 install urllib3
      script: sudo pip3 install -r requirements.txt
      script: go run main.go &
      script: robot tests.robot
      

after_success:
  - bash <(curl -s https://codecov.io/bash)
